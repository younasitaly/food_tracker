
<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tracciatore Alimenti</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      background: #f0f2f5;
      color: #222;
    }
    #loginBox, #mainApp {
      max-width: 500px;
      margin: 100px auto 50px;
      background: white;
      padding: 25px;
      border-radius: 8px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
      color: #4CAF50;
      margin-bottom: 20px;
    }
    input, button {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      font-size: 16px;
      border-radius: 5px;
      border: 1.5px solid #ccc;
      box-sizing: border-box;
    }
    input:focus {
      border-color: #4caf50;
      outline: none;
    }
    button {
      background: #4caf50;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background: #43a047;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      padding: 10px 8px;
      border-bottom: 1px solid #ddd;
      text-align: center;
    }
    th {
      background: #e8f5e9;
      color: #2e7d32;
    }
    tr.expired {
      background: #ffebee;
      color: #b71c1c;
      font-weight: bold;
    }
    tr.expiring-soon {
      background: #fff8e1;
      color: #f9a825;
      font-weight: bold;
    }
    .btn-action {
      cursor: pointer;
      border: none;
      background: none;
      font-size: 18px;
      margin: 0 5px;
    }
    .btn-edit { color: #2e7d32; }
    .btn-delete { color: #b71c1c; }

    #logoutBtn {
      position: fixed;
      top: 15px;
      right: 15px;
      background: #e53935;
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 700;
      font-size: 14px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      display: none;
      z-index: 9999;
      max-width: 120px;
      text-align: center;
      white-space: nowrap;
    }
    #logoutBtn:hover {
      background: #ab000d;
    }
  </style>
</head>
<body>

<div id="loginBox">
  <h2>üîê Accesso Amministratore</h2>
  <input id="username" placeholder="Username" autocomplete="username" />
  <input id="password" type="password" placeholder="Password" autocomplete="current-password" />
  <button id="loginBtn">Accedi</button>
</div>

<div id="mainApp" style="display:none;">
  <h2>üç≤ Tracciatore Alimenti</h2>
  <form id="itemForm">
    <input list="productList" id="itemName" placeholder="Nome prodotto" autocomplete="off" />
    <datalist id="productList"></datalist>
    <input id="datePrepared" type="date" />
    <input id="expiryDate" type="date" />
    <button type="submit">Aggiungi Prodotto</button>
  </form>

  <table>
    <thead>
      <tr>
        <th>Nome</th>
        <th>Preparato</th>
        <th>Scadenza</th>
        <th>Stato</th>
        <th>Azioni</th>
      </tr>
    </thead>
    <tbody id="itemTable"></tbody>
  </table>
</div>

<button id="logoutBtn">Esci</button>

<script>
  const loginBox = document.getElementById("loginBox");
  const mainApp = document.getElementById("mainApp");
  const logoutBtn = document.getElementById("logoutBtn");

  const usernameInput = document.getElementById("username");
  const passwordInput = document.getElementById("password");
  const loginBtn = document.getElementById("loginBtn");

  const itemForm = document.getElementById("itemForm");
  const itemNameInput = document.getElementById("itemName");
  const datePreparedInput = document.getElementById("datePrepared");
  const expiryDateInput = document.getElementById("expiryDate");
  const productList = document.getElementById("productList");
  const itemTable = document.getElementById("itemTable");

  const ADMIN_USER = "Admin";
  const ADMIN_PASS = "Miraggio@46";

  let items = [];
  let productNames = [];
  let editIndex = -1;

  function saveData() {
    localStorage.setItem("foodTrackerItems", JSON.stringify(items));
    localStorage.setItem("foodTrackerProductNames", JSON.stringify(productNames));
  }
  function loadData() {
    items = JSON.parse(localStorage.getItem("foodTrackerItems") || "[]");
    productNames = JSON.parse(localStorage.getItem("foodTrackerProductNames") || "[]");
  }

  function renderProductNames() {
    productList.innerHTML = "";
    productNames.forEach(name => {
      const option = document.createElement("option");
      option.value = name;
      productList.appendChild(option);
    });
  }

  function renderItems() {
    itemTable.innerHTML = "";
    const today = new Date();
    today.setHours(0,0,0,0);

    items.forEach((item, i) => {
      const expiryDate = new Date(item.expiry);
      const daysLeft = Math.floor((expiryDate - today) / (1000*60*60*24));
      let statusText = "";
      let rowClass = "";

      if (expiryDate < today) {
        statusText = "Scaduto";
        rowClass = "expired";
      } else if (daysLeft <= 1) {
        statusText = "In Scadenza";
        rowClass = "expiring-soon";
      } else {
        statusText = `${daysLeft} giorni rimasti`;
      }

      const tr = document.createElement("tr");
      tr.className = rowClass;
      tr.innerHTML = `
        <td title="${item.name}">${item.name}</td>
        <td>${item.prepared}</td>
        <td>${item.expiry}</td>
        <td>${statusText}</td>
        <td>
          <button class="btn-action btn-edit" title="Modifica" onclick="editItem(${i})">‚úèÔ∏è</button>
          <button class="btn-action btn-delete" title="Elimina" onclick="deleteItem(${i})">üóëÔ∏è</button>
        </td>
      `;
      itemTable.appendChild(tr);
    });
  }

  function checkLogin() {
    const u = usernameInput.value.trim();
    const p = passwordInput.value.trim();
    if (u === ADMIN_USER && p === ADMIN_PASS) {
      localStorage.setItem("foodTrackerLoggedIn", "yes");
      loginBox.style.display = "none";
      mainApp.style.display = "block";
      logoutBtn.style.display = "block";
      loadData();
      renderProductNames();
      renderItems();
    } else {
      alert("Credenziali non valide");
    }
  }

  function logout() {
    localStorage.removeItem("foodTrackerLoggedIn");
    loginBox.style.display = "block";
    mainApp.style.display = "none";
    logoutBtn.style.display = "none";
    editIndex = -1;
    clearForm();
  }

  function addItem() {
    const name = itemNameInput.value.trim();
    const prepared = datePreparedInput.value;
    const expiry = expiryDateInput.value;

    if (!name || !prepared || !expiry) {
      alert("Per favore, completa tutti i campi.");
      return;
    }
    if (new Date(prepared) > new Date(expiry)) {
      alert("La data di preparazione non pu√≤ essere successiva alla scadenza.");
      return;
    }

    if (editIndex === -1) {
      items.push({name, prepared, expiry});
      if (!productNames.includes(name)) productNames.push(name);
    } else {
      items[editIndex] = {name, prepared, expiry};
      if (!productNames.includes(name)) productNames.push(name);
      editIndex = -1;
    }
    saveData();
    renderProductNames();
    renderItems();
    clearForm();
  }

  function editItem(i) {
    const item = items[i];
    itemNameInput.value = item.name;
    datePreparedInput.value = item.prepared;
    expiryDateInput.value = item.expiry;
    editIndex = i;
  }

  function deleteItem(i) {
    if (confirm(`Sei sicuro di eliminare "${items[i].name}"?`)) {
      items.splice(i, 1);
      saveData();
      renderItems();
    }
  }

  function clearForm() {
    itemNameInput.value = "";
    datePreparedInput.value = "";
    expiryDateInput.value = "";
    editIndex = -1;
  }

  // EVENTS
  loginBtn.addEventListener("click", checkLogin);
  logoutBtn.addEventListener("click", logout);
  itemForm.addEventListener("submit", function(e){
    e.preventDefault();
    addItem();
  });

  // ON LOAD
  window.onload = () => {
    if(localStorage.getItem("foodTrackerLoggedIn") === "yes") {
      loginBox.style.display = "none";
      mainApp.style.display = "block";
      logoutBtn.style.display = "block";
      loadData();
      renderProductNames();
      renderItems();
    }
  }
</script>
</body>
</html>
