
<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tracciatore Alimenti</title>
  <style>
    /* Reset & base */
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0; padding: 0; background: #f5f7fa;
      color: #333;
    }

    /* Container */
    .container {
      max-width: 650px;
      margin: 60px auto 40px;
      background: white;
      padding: 25px 30px 40px;
      border-radius: 10px;
      box-shadow: 0 6px 15px rgba(0,0,0,0.1);
    }

    h2 {
      text-align: center;
      color: #4CAF50;
      margin-bottom: 25px;
    }

    /* Login Box */
    #loginBox {
      max-width: 400px;
      margin: 120px auto;
      background: white;
      padding: 30px 30px 40px;
      border-radius: 10px;
      box-shadow: 0 6px 15px rgba(0,0,0,0.1);
    }

    input[type=text], input[type=password], input[type=date], input[list] {
      width: 100%;
      padding: 10px 14px;
      margin: 10px 0 16px;
      font-size: 16px;
      border: 2px solid #ddd;
      border-radius: 6px;
      transition: border-color 0.3s ease;
    }
    input[type=text]:focus, input[type=password]:focus, input[type=date]:focus, input[list]:focus {
      border-color: #4caf50;
      outline: none;
    }

    button {
      width: 100%;
      padding: 12px;
      background: #4caf50;
      color: white;
      font-weight: 700;
      font-size: 17px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background: #43a047;
    }

    /* Main App Table */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 22px;
      font-size: 14px;
    }
    th, td {
      text-align: center;
      padding: 10px 8px;
      border-bottom: 1px solid #ddd;
      max-width: 120px;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    }
    th {
      background: #f1f8f3;
      font-weight: 600;
      color: #4caf50;
    }

    tr.expired {
      background: #ffebee;
      color: #c62828;
      font-weight: 600;
    }
    tr.expiring-soon {
      background: #fff8e1;
      color: #f9a825;
      font-weight: 600;
    }

    /* Buttons inside table */
    .btn-action {
      font-size: 16px;
      border: none;
      background: none;
      cursor: pointer;
      margin: 0 5px;
      padding: 4px 6px;
      border-radius: 5px;
      transition: background-color 0.25s ease;
    }
    .btn-edit {
      color: #2e7d32;
    }
    .btn-edit:hover {
      background: #c8e6c9;
    }
    .btn-delete {
      color: #c62828;
    }
    .btn-delete:hover {
      background: #ffcdd2;
    }

    /* Logout button top-right */
    #logoutBtn {
      position: fixed;
      top: 14px;
      right: 14px;
      padding: 10px 16px;
      background: #e53935;
      border: none;
      color: white;
      font-weight: 700;
      font-size: 14px;
      border-radius: 6px;
      cursor: pointer;
      box-shadow: 0 3px 8px rgba(0,0,0,0.2);
      transition: background-color 0.3s ease;
      z-index: 1000;
      display: none; /* hidden initially */
    }
    #logoutBtn:hover {
      background: #b71c1c;
    }

    /* Responsive */
    @media (max-width: 600px) {
      .container, #loginBox {
        margin: 30px 15px;
        padding: 20px 20px 30px;
      }
      th, td {
        font-size: 12px;
        max-width: 70px;
        padding: 8px 4px;
      }
      button {
        font-size: 15px;
      }
      #logoutBtn {
        padding: 8px 14px;
        font-size: 13px;
      }
    }
  </style>
</head>
<body>

<!-- Login Form -->
<div id="loginBox">
  <h2>üîê Accesso Amministratore</h2>
  <input id="username" placeholder="Username" autocomplete="username" />
  <input id="password" type="password" placeholder="Password" autocomplete="current-password" />
  <button onclick="checkLogin()">Accedi</button>
</div>

<!-- Main App -->
<div class="container" id="mainApp" style="display:none;">
  <h2>üç≤ Tracciatore Alimenti</h2>
  <form onsubmit="event.preventDefault(); addItem();">
    <input list="productList" id="itemName" placeholder="Nome prodotto" autocomplete="off" />
    <datalist id="productList"></datalist>
    <input id="datePrepared" type="date" />
    <input id="expiryDate" type="date" />
    <button type="submit">Aggiungi Prodotto</button>
  </form>

  <table>
    <thead>
      <tr>
        <th>Nome</th>
        <th>Preparato</th>
        <th>Scadenza</th>
        <th>Stato</th>
        <th>Azioni</th>
      </tr>
    </thead>
    <tbody id="itemTable"></tbody>
  </table>
</div>

<button id="logoutBtn" onclick="logout()">Esci</button>

<script>
  // Shortcut function
  const $ = id => document.getElementById(id);

  // Constants
  const ADMIN_USER = "Admin";
  const ADMIN_PASS = "Miraggio@46";

  // LocalStorage keys
  const STORAGE_KEY_ITEMS = "foodTrackerItems";
  const STORAGE_KEY_NAMES = "foodTrackerProductNames";
  const STORAGE_KEY_LOGGEDIN = "foodTrackerLoggedIn";

  // Elements
  const loginBox = $("loginBox");
  const mainApp = $("mainApp");
  const logoutBtn = $("logoutBtn");
  const itemTable = $("itemTable");
  const productList = $("productList");

  // Data in memory
  let items = [];
  let productNames = [];

  // --- LOGIN FUNCTIONS ---
  function checkLogin() {
    const u = $("username").value.trim();
    const p = $("password").value.trim();
    if (u === ADMIN_USER && p === ADMIN_PASS) {
      localStorage.setItem(STORAGE_KEY_LOGGEDIN, "yes");
      loginBox.style.display = "none";
      mainApp.style.display = "block";
      logoutBtn.style.display = "block";
      loadData();
      renderItems();
      renderProductNames();
    } else {
      alert("Credenziali non valide");
    }
  }

  function logout() {
    localStorage.removeItem(STORAGE_KEY_LOGGEDIN);
    loginBox.style.display = "block";
    mainApp.style.display = "none";
    logoutBtn.style.display = "none";
  }

  // --- STORAGE ---
  function loadData() {
    const storedItems = localStorage.getItem(STORAGE_KEY_ITEMS);
    const storedNames = localStorage.getItem(STORAGE_KEY_NAMES);
    items = storedItems ? JSON.parse(storedItems) : [];
    productNames = storedNames ? JSON.parse(storedNames) : [];
  }

  function saveData() {
    localStorage.setItem(STORAGE_KEY_ITEMS, JSON.stringify(items));
    localStorage.setItem(STORAGE_KEY_NAMES, JSON.stringify(productNames));
  }

  // --- RENDER ---
  function renderItems() {
    itemTable.innerHTML = "";
    const today = new Date();
    today.setHours(0,0,0,0);

    items.forEach((item, i) => {
      const expiryDate = new Date(item.expiry);
      const daysLeft = Math.floor((expiryDate - today) / (1000*60*60*24));

      let statusText = "";
      let rowClass = "";
      if (expiryDate < today) {
        statusText = "Scaduto";
        rowClass = "expired";
      } else if (daysLeft <= 1) {
        statusText = "In Scadenza";
        rowClass = "expiring-soon";
      } else {
        statusText = `${daysLeft} giorni rimasti`;
      }

      const tr = document.createElement("tr");
      tr.className = rowClass;

      tr.innerHTML = `
        <td title="${item.name}">${item.name}</td>
        <td>${formatDate(item.prepared)}</td>
        <td>${formatDate(item.expiry)}</td>
        <td>${statusText}</td>
        <td>
          <button class="btn-action btn-edit" title="Modifica" onclick="editItem(${i})">‚úèÔ∏è</button>
          <button class="btn-action btn-delete" title="Elimina" onclick="deleteItem(${i})">üóëÔ∏è</button>
        </td>
      `;

      itemTable.appendChild(tr);
    });
  }

  function renderProductNames() {
    productList.innerHTML = "";
    productNames.forEach(name => {
      const option = document.createElement("option");
      option.value = name;
      productList.appendChild(option);
    });
  }

  // --- ADD/EDIT/DELETE ---
  let editIndex = -1;

  function addItem() {
    const name = $("itemName").value.trim();
    const prepared = $("datePrepared").value;
    const expiry = $("expiryDate").value;

    if (!name || !prepared || !expiry) {
      alert("Compila tutti i campi");
      return;
    }

    if (new Date(prepared) > new Date(expiry)) {
      alert("La data di preparazione non pu√≤ essere successiva alla scadenza");
      return;
    }

    if (editIndex === -1) {
      // Add new
      items.push({name, prepared, expiry});
      if (!productNames.includes(name)) {
        productNames.push(name);
      }
    } else {
      // Edit existing
      items[editIndex] = {name, prepared, expiry};
      if (!productNames.includes(name)) {
        productNames.push(name);
      }
      editIndex = -1;
    }

    saveData();
    renderItems();
    renderProductNames();
    clearForm();
  }

  function editItem(i) {
    const item = items[i];
    $("itemName").value = item.name;
    $("datePrepared").value = item.prepared;
    $("expiryDate").value = item.expiry;
    editIndex = i;
  }

  function deleteItem(i) {
    if (confirm(`Sei sicuro di eliminare "${items[i].name}"?`)) {
      items.splice(i, 1);
      saveData();
      renderItems();
    }
  }

  function clearForm() {
    $("itemName").value = "";
    $("datePrepared").value = "";
    $("expiryDate").value = "";
  }

  // --- ON LOAD ---
  window.onload = () => {
    const loggedIn = localStorage.getItem(STORAGE_KEY_LOGGEDIN);
    if (loggedIn === "yes") {
      loginBox.style.display = "none";
      mainApp.style.display = "block";
      logoutBtn.style.display = "block";
      loadData();
      renderItems();
      renderProductNames();
    }
  };
</script>
</body>
</html>
